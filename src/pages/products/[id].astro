---
import { FirestoreProductRepository } from '../../infrastructure/repositories/FirestoreProductRepository';
import { FirestoreUserRepository } from '../../infrastructure/repositories/FirestoreUserRepository';
import { GetProductById } from '../../application/use-cases/GetProductById';
import { GetUserById } from '../../application/use-cases/GetUserById';
import ProductDetailView from '../../presentation/components/ProductDetailView.vue';
import BottomNav from '../../presentation/components/BottomNav.vue';
import CartCounter from '../../presentation/components/CartCounter.vue';
import { Image } from 'astro:assets';
import logoNaya from '../../assets/logo.svg';
import '../../styles/global.css';

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/404');
}

const productRepo = new FirestoreProductRepository();
const userRepo = new FirestoreUserRepository();

const getProductById = new GetProductById(productRepo);
const getUserById = new GetUserById(userRepo);

const product = await getProductById.execute(id);

if (!product) {
  return Astro.redirect('/404');
}

const seller = await getUserById.execute(product.sellerId);

const marketplaceName = import.meta.env.PUBLIC_MARKETPLACE_NAME || 'Naya';
---

<html lang="es">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{product.title} - {marketplaceName}</title>
	</head>
	<body class="bg-[#FDFCFB] min-h-screen pb-24">
		<!-- Header Estilo Naya -->
		<header class="bg-[#D9D2C8] sticky top-0 z-50 shadow-sm">
			<div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
				<!-- Botón Volver -->
				<a href="javascript:history.back()" class="p-2 hover:bg-black/5 rounded-full transition-colors">
					<svg class="w-8 h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M15 19l-7-7 7-7" />
					</svg>
				</a>

				<!-- Logo Central -->
				<div class="flex flex-col items-center">
					<Image src={logoNaya} alt="Logo Naya" class="h-10 w-auto" />
				</div>

				<!-- Carrito -->
				<CartCounter client:only="vue" />
			</div>
		</header>

		<main class="max-w-7xl mx-auto px-6 py-12 lg:py-20">
			<ProductDetailView client:load product={product} seller={seller} />
		</main>

		<!-- Navegación Inferior -->
		<BottomNav client:only="vue" />
	</body>
</html>
